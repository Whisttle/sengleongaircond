<!DOCTYPE html>
{% load favicon_tags %}
<html lang="en">
    <head>
        {% favicon_meta %}
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- SEO Meta Tags -->
        <title>{{self.title}}</title>
        <meta name="description" content="Professional air conditioning installation, repair & maintenance in Klang Valley. 20+ years experience, certified technicians, competitive pricing. Call +6012-652 6665 for free quote.">
        <meta name="keywords" content="air conditioning services Klang Valley, aircond repair KL, aircond installation Selangor, aircon maintenance Malaysia, certified aircond technician, Seng Leong Engineering">
        <meta name="author" content="Seng Leong Engineering Sdn Bhd">
        <meta name="robots" content="index, follow">
        <link rel="canonical" href="https://sengleongaircond.com/">
        
        <!-- Open Graph Meta Tags -->
        <meta property="og:title" content="{{self.title}}">
        <meta property="og:description" content="Professional air conditioning installation, repair & maintenance in Klang Valley. 20+ years experience, certified technicians, competitive pricing.">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://sengleongaircond.com/">
        <meta property="og:image" content="https://sengleongaircond.com/static/images/SL_HD_logo.jpg">
        <meta property="og:locale" content="en_MY">
        <meta property="og:site_name" content="Seng Leong Engineering Sdn Bhd">
        
        <!-- Twitter Card Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{self.title}}">
        <meta name="twitter:description" content="Professional air conditioning installation, repair & maintenance in Klang Valley. 20+ years experience, certified technicians.">
        <meta name="twitter:image" content="https://sengleongaircond.com/static/images/SL_HD_logo.jpg">
        
        <!-- Business Information -->
        <meta name="geo.region" content="MY-10">
        <meta name="geo.placename" content="Klang, Selangor">
        <meta name="geo.position" content="3.0319;101.4443">
        <meta name="ICBM" content="3.0319, 101.4443">
        
        <!-- Preconnect for Performance -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="preconnect" href="https://cdnjs.cloudflare.com">
        
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <!-- Font Awesome for Icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        
        <!-- Structured Data - Local Business Schema -->
        <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "Seng Leong Engineering Sdn Bhd",
        "image": "https://sengleongaircond.com/static/images/SL_HD_logo.jpg",
        "description": "Professional air conditioning installation, repair and maintenance services in Klang Valley with over 20 years of experience.",
        "url": "https://sengleongaircond.com/",
        "telephone": "+60126526665",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "31, Jalan Bendahara 2, Taman Sejati",
            "addressLocality": "Klang",
            "addressRegion": "Selangor",
            "postalCode": "41200",
            "addressCountry": "MY"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 3.0319,
            "longitude": 101.4443
        },
        "openingHours": "Mo-Su 08:00-18:00",
        "priceRange": "$$",
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "reviewCount": "71"
        },
        "serviceArea": {
            "@type": "GeoCircle",
            "geoMidpoint": {
            "@type": "GeoCoordinates",
            "latitude": 3.0319,
            "longitude": 101.4443
            },
            "geoRadius": "50000"
        },
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Air Conditioning Services",
            "itemListElement": [
            {
                "@type": "Offer",
                "itemOffered": {
                "@type": "Service",
                "name": "Air Conditioning Installation"
                }
            },
            {
                "@type": "Offer",
                "itemOffered": {
                "@type": "Service",
                "name": "Air Conditioning Repair"
                }
            },
            {
                "@type": "Offer",
                "itemOffered": {
                "@type": "Service",
                "name": "Air Conditioning Maintenance"
                }
            }
            ]
        }
        }
        </script>
        
    </head>
    <body>
    {% load static %}

    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    {% block content %}

    <!-- Header & Navigation -->
    {% if page.show_navigation %} 
        <header>
            <nav class="nav-container">
                <a href="index.html" class="logo" style="display:inline-block; max-width:100%;">
                    <span style="display: flex; align-items: center; gap: 8px; max-width: 100%; width: 100%;">
                        <img src="{% static "images/SL_HD_logo.jpg" %}" alt="logo-icon" class="logo-icon" >
                        <span class="company-name" >{{ page.company_name }}</span>
                    </span>
                </a>
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-wrapper">
                    <ul class="nav-links">
                        <li><a href="#home" class="nav-link">Home</a></li>
                        <li><a href="#services" class="nav-link">Services</a></li>
                        <li><a href="#partners" class="nav-link">Our Partner</a></li>
                        <li><a href="#testimonials" class="nav-link">Reviews</a></li>
                        <li><a href="#contact" class="nav-link">Contact</a></li>
                        
                    </ul>
                </div>
            </nav>
        </header>
         <script>
        document.addEventListener('DOMContentLoaded', () => {
        const hamburger = document.querySelector('.hamburger');
        const navWrapper = document.querySelector('.nav-wrapper');
        const navLinks = document.querySelectorAll('.nav-links a');
        // Create overlay if not present
        let overlay = document.querySelector('.mobile-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.className = 'mobile-overlay';
            document.body.appendChild(overlay);
        }

        function closeMenu() {
            hamburger.classList.remove('active');
            navWrapper.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Close menu when clicking outside the sidebar menu(nav-wrapper)
        document.addEventListener('click', function(e) {
            if (
                navWrapper.classList.contains('active') &&
                !navWrapper.contains(e.target) &&
                !hamburger.contains(e.target)
            ) {
                closeMenu();
            }
        });

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navWrapper.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', closeMenu);

        navLinks.forEach(link => {
            link.addEventListener('click', closeMenu);
        });

        navWrapper.addEventListener('click', function(e) {
            // Only trigger if nav-wrapper itself is clicked, not its children
            if (e.target === navWrapper && navWrapper.classList.contains('active')) {
                navWrapper.classList.remove('active');
                document.querySelector('.hamburger').classList.remove('active');
                document.querySelector('.mobile-overlay').classList.remove('active');
            }
        });
    });
    </script>
    {% endif %}



        <!-- Hero Section -->
    <section class="hero" id="home"{% if page.hero_background_image %} style="background-image: url('{{ page.hero_background_image.url }}');"{% endif %}>
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">{{ page.hero_title }}</h1>
                <p class="hero-description">{{ page.hero_description }}</p>
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                    <!-- Elfsight Google Reviews | Untitled Google Reviews -->
                    <script src="https://elfsightcdn.com/platform.js" async></script>
                    <div class="elfsight-app-f1c7e6c9-ea1c-4ef4-8946-ec89aa8d9b84" data-elfsight-app-lazy></div>
                </div>
            </div>
            <div class="hero-form">
                <h3 class="form-title">{{ page.form_title }}</h3>
                <p class="form-subtitle">{{ page.form_subtitle }}</p>
                
                <!-- Message Display -->
                <div class="message" id="form-message" style="display: none; padding: 15px; border-radius: 8px; margin: 20px 0;"></div>
                
                <form id="quote-form" itemscope itemtype="https://schema.org/ContactPoint">
                    <div class="form-row">
                        <div class="form-group form-half">
                            <input type="text" class="form-input" name="name" placeholder="Full Name" required>
                        </div>
                        <div class="form-group form-half">
                            <input type="email" class="form-input" name="email" placeholder="Email Address" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="tel" class="form-input" name="phone" placeholder="Phone Number" required>
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" name="budget" placeholder="Budget (e.g. RM2000)">
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" name="location" placeholder="Location Area (e.g. Klang, PJ, KL)" required>
                    </div>
                    <div class="form-group">
                        <textarea class="form-input" name="message" placeholder="Additional requirements or comments (optional)" rows="3"></textarea>
                    </div>
                    <button type="submit" class="cta-button" id="submit-btn">
                        <span class="loading-spinner" id="loading" style="display: none; width: 20px; height: 20px; border: 2px solid transparent; border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></span>
                        <span id="button-text">Get Free Quote Now</span>
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- USP Features Section -->
    <section class="usp-section" id="services">
        <div class="container">
            <h2 class="section-title">{{ page.services_title }}</h2>
            <p class="section-subtitle">{{ page.services_subtitle }}</p>
            
            <div class="usp-grid">
                {% for feature in page.usp_features.all %}
                <div class="usp-card">
                   <div class="usp-icon">
                        <i class="{{ feature.icon_class }}"></i>
                    </div>
                    <h3 class="usp-title">{{ feature.title }}</h3>
                    <p class="usp-description">{{ feature.description }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>


    <!-- Expertise Section -->
    <section class="expertise-section">
        <div class="container">
            <h2 class="section-title" style="color: var(--white);">{{ page.stats_title }}</h2>
            <p class="section-subtitle" style="color: rgba(255, 255, 255, 0.8);">{{ page.stats_subtitle }}</p>
            
            <div class="expertise-grid">
                {% for stat in page.statistics.all %}
                <div class="stat-item" style="animation-delay: {{ forloop.counter0|floatformat:1 }}s;">
                    <span class="stat-number">{{ stat.number }}</span>
                    <span class="stat-label">{{ stat.label }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Partners Section -->
    <section class="partners-section" id ='partners'>
        <h2 class="section-title">{{ page.partners_title }}</h2>
        <p class="section-subtitle">{{ page.partners_subtitle }}</p>
        <div class="brand-carousel">
            <button class="brand-arrow brand-arrow-left" type="button">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="brand-slides">
                {% load wagtailimages_tags %}
                {% for partner in page.brand_partners.all %}
                {% image partner.image class="brand-slide" alt=partner.alt_text original %}
                {% endfor %}
            </div>
            <button class="brand-arrow brand-arrow-right" type="button">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <div class="brand-dots"></div>
        </div>
        
    </section>

     <!-- Testimonials Section -->
    <section class="testimonials-section" id="testimonials">
        <div class="container">
            <h2 class="section-title">Customer Reviews & Testimonials</h2>
            <p class="section-subtitle">Real feedback from satisfied customers across Klang Valley, Selangor, and Kuala Lumpur</p>
            
            <div class="testimonials-carousel">
                      <!-- Elfsight Google Reviews | Untitled Google Reviews -->
                <script src="https://elfsightcdn.com/platform.js" async></script>
                <div class="elfsight-app-953cfb60-2f8f-445b-92f9-9380097ebe47" data-elfsight-app-lazy></div>

                <div class="cta-section" style="width: 100%; display: flex; justify-content: center; align-items: center; margin-top: 2rem;">
                    <a href="#home" style="width: 50%;"><button class="cta-button"style="border-radius: 16px !important;">Get Quote</button></a>
                </div>
            </div>
        </div>
    </section>

    {% endblock content %}
    <script>
        // WhatsApp Form Handler Class
        class WhatsAppFormHandler {
            constructor() {
                this.form = document.getElementById('quote-form');
                this.submitBtn = document.getElementById('submit-btn');
                this.buttonText = document.getElementById('button-text');
                this.loading = document.getElementById('loading');
                this.messageDiv = document.getElementById('form-message');
                
                // Get WhatsApp number and message template from CMS
                this.whatsappNumber = '{{ page.form_whatsapp_number }}';
                this.messageTemplate = `{{ page.form_whatsapp_message_template|escapejs }}`;
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
            }

            collectFormData() {
                const formData = new FormData(this.form);
                return {
                    name: formData.get('name') || '',
                    email: formData.get('email') || '',
                    phone: formData.get('phone') || '',
                    budget: formData.get('budget') || '',
                    location: formData.get('location') || '',
                    message: formData.get('message') || '',
                    timestamp: new Date().toLocaleString('en-MY', {
                        timeZone: 'Asia/Kuala_Lumpur',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                };
            }

            formatWhatsAppMessage(data) {
                // Use the CMS template if available, otherwise use default format
                if (this.messageTemplate && this.messageTemplate.trim() !== '') {
                    return this.messageTemplate
                        .replace(/{name}/g, data.name)
                        .replace(/{email}/g, data.email)
                        .replace(/{phone}/g, data.phone)
                        .replace(/{budget}/g, data.budget)
                        .replace(/{location}/g, data.location)
                        .replace(/{message}/g, data.message);
                } else {
                    // Fallback to default format
                    let message = `üéØ NEW QUOTE REQUEST\n\n`;
                    message += `üë§ Customer Details:\n`;
                    message += `‚Ä¢ Name: ${data.name}\n`;
                    message += `‚Ä¢ Email: ${data.email}\n`;
                    message += `‚Ä¢ Phone: ${data.phone}\n\n`;
                    message += `üìç Service Details:\n`;
                    message += `‚Ä¢ Location: ${data.location}\n`;
                    
                    if (data.budget) {
                        message += `‚Ä¢ Budget: ${data.budget}\n`;
                    }
                    
                    if (data.message) {
                        message += `\nüí¨ Additional Comments:\n${data.message}\n`;
                    }
                    
                    return message;
                }
            }

            generateWhatsAppURL(message) {
                if (!this.whatsappNumber) {
                    throw new Error('WhatsApp number not configured');
                }

                // Clean phone number thoroughly
                // Remove spaces, dashes, plus signs, parentheses, and any non-digit characters
                // Also handle Unicode characters that might be invisible
                let cleanPhone = this.whatsappNumber
                    .trim() // Remove leading/trailing whitespace
                    .replace(/[\u200B-\u200D\uFEFF\u202A-\u202E]/g, '') // Remove invisible Unicode characters
                    .replace(/[^\d]/g, ''); // Keep only digits
        
                
                if (!cleanPhone || cleanPhone.length < 10) {
                    throw new Error('Invalid phone number after cleaning');
                }
                
                // Encode the message for URL
                const encodedMessage = encodeURIComponent(message);
                
                // Generate WhatsApp Web URL
                const whatsappURL = `https://api.whatsapp.com/send/?phone=${cleanPhone}&text=${encodedMessage}&type=phone_number&app_absent=0`;
                
                return whatsappURL;
            }

            openWhatsApp(url) {
                // Open WhatsApp in new window/tab
                window.open(url, '_blank', 'noopener,noreferrer');
            }

            showMessage(text, type = 'success') {
                this.messageDiv.textContent = text;
                this.messageDiv.style.display = 'block';
                this.messageDiv.style.background = type === 'success' ? '#d4edda' : '#f8d7da';
                this.messageDiv.style.color = type === 'success' ? '#155724' : '#721c24';
                this.messageDiv.style.border = type === 'success' ? '1px solid #c3e6cb' : '1px solid #f5c6cb';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    this.messageDiv.style.display = 'none';
                }, 5000);
            }

            setLoading(isLoading) {
                this.submitBtn.disabled = isLoading;
                this.loading.style.display = isLoading ? 'inline-block' : 'none';
                this.buttonText.textContent = isLoading ? 'Sending...' : 'Get Free Quote Now';
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                this.setLoading(true);
                
                try {
                    const formData = this.collectFormData();
                    const whatsappMessage = this.formatWhatsAppMessage(formData);
                    
                    // Generate WhatsApp Web URL
                    const whatsappURL = this.generateWhatsAppURL(whatsappMessage);
                    
                    // Open WhatsApp
                    this.openWhatsApp(whatsappURL);
                    
                    this.showMessage('{{ page.form_success_message|escapejs }}', 'success');
                    this.form.reset();
                    
                    // Optional: Log the URL for debugging
                    console.log('WhatsApp URL:', whatsappURL);
                    
                } catch (error) {
                    console.error('Error generating WhatsApp link:', error);
                    this.showMessage(`‚ùå Error: ${error.message}`, 'error');
                } finally {
                    this.setLoading(false);
                }
            }
        }

        // Initialize WhatsApp Form Handler
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the WhatsApp form handler
            window.whatsappForm = new WhatsAppFormHandler();
            
            // Fix WhatsApp links with clean phone numbers
            fixWhatsAppLinks();
        });

        // Function to clean phone numbers and fix WhatsApp links
        function fixWhatsAppLinks() {
            const rawWhatsAppNumber = '{{ page.whatsapp_number }}';
            const whatsAppMessage = `{{ page.whatsapp_message|escapejs }}`;
            
            // Clean phone number thoroughly
            const cleanPhone = rawWhatsAppNumber
                .trim()
                .replace(/[\u200B-\u200D\uFEFF\u202A-\u202E]/g, '') // Remove invisible Unicode characters
                .replace(/[^\d]/g, ''); // Keep only digits
            
            if (cleanPhone && cleanPhone.length >= 10) {
                // Update all WhatsApp links on the page
                const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
                whatsappLinks.forEach(link => {
                    const encodedMessage = encodeURIComponent(whatsAppMessage);
                    const newHref = `https://wa.me/${cleanPhone}?text=${encodedMessage}`;
                    link.href = newHref;
                });
            } else {
                console.error('Invalid WhatsApp number after cleaning:', cleanPhone);
            }
        }

        // Add CSS animation for loading spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        {% comment %} // Testimonials Carousel Slider
        document.addEventListener('DOMContentLoaded', function () {
            const testimonialCarousel = document.querySelector('.testimonials-carousel');
            if (!testimonialCarousel) return;
            
            const grid = testimonialCarousel.querySelector('.testimonials-grid');
            const cards = Array.from(grid.querySelectorAll('.testimonial-card'));
            const leftArrow = testimonialCarousel.querySelector('.testimonial-arrow-left');
            const rightArrow = testimonialCarousel.querySelector('.testimonial-arrow-right');
            const dotsContainer = testimonialCarousel.querySelector('.testimonial-dots');
            
            let currentSlide = 0;
            let cardsPerView = 4; // Default for desktop
            
            // Function to update cards per view based on screen size
            function updateCardsPerView() {
                if (window.innerWidth <= 768) {
                    cardsPerView = 1;
                } else if (window.innerWidth <= 1024) {
                    cardsPerView = 2;
                } else {
                    cardsPerView = 4;
                }
            }
            
            // Calculate total slides
            function getTotalSlides() {
                return Math.ceil(cards.length / cardsPerView);
            }
            
            // Create dots
            function createDots() {
                dotsContainer.innerHTML = '';
                const totalSlides = getTotalSlides();
                for (let i = 0; i < totalSlides; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'testimonial-dot' + (i === 0 ? ' active' : '');
                    dot.addEventListener('click', () => goToSlide(i));
                    dotsContainer.appendChild(dot);
                }
            }
            
            // Update dots
            function updateDots() {
                const dots = dotsContainer.querySelectorAll('.testimonial-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentSlide);
                });
            }
            
            // Go to specific slide
            function goToSlide(slideIndex) {
                const totalSlides = getTotalSlides();
                currentSlide = Math.max(0, Math.min(slideIndex, totalSlides - 1));
                
                // Calculate the percentage to move based on cards per view
                const cardWidth = 100 / cardsPerView; // Each card takes this % of container width
                const translateX = -(currentSlide * cardsPerView * cardWidth);
                grid.style.transform = `translateX(${translateX}%)`;
                
                updateDots();
                updateArrowStates();
            }
            
            // Update arrow states
            function updateArrowStates() {
                const totalSlides = getTotalSlides();
                leftArrow.style.opacity = currentSlide === 0 ? '0.5' : '1';
                rightArrow.style.opacity = currentSlide === totalSlides - 1 ? '0.5' : '1';
                leftArrow.style.pointerEvents = currentSlide === 0 ? 'none' : 'auto';
                rightArrow.style.pointerEvents = currentSlide === totalSlides - 1 ? 'none' : 'auto';
            }
            
            // Next slide
            function nextSlide() {
                const totalSlides = getTotalSlides();
                if (currentSlide < totalSlides - 1) {
                    goToSlide(currentSlide + 1);
                }
            }
            
            // Previous slide
            function prevSlide() {
                if (currentSlide > 0) {
                    goToSlide(currentSlide - 1);
                }
            }
            
            // Initialize
            function init() {
                updateCardsPerView();
                createDots();
                goToSlide(0);
            }
            
            // Event listeners
            leftArrow.addEventListener('click', prevSlide);
            rightArrow.addEventListener('click', nextSlide);
            
            // Handle window resize
            window.addEventListener('resize', () => {
                updateCardsPerView();
                createDots();
                goToSlide(0); // Reset to first slide on resize
            });
            
            // Initialize the carousel
            init();
        }); {% endcomment %}

        // Brand Carousel Slider
        document.addEventListener('DOMContentLoaded', function () {
            const carousel = document.querySelector('.brand-carousel');
            if (!carousel) return;
            const slidesContainer = carousel.querySelector('.brand-slides');
            const slides = Array.from(carousel.querySelectorAll('.brand-slide'));
            const dotsContainer = carousel.querySelector('.brand-dots');
            const leftArrow = carousel.querySelector('.brand-arrow-left');
            const rightArrow = carousel.querySelector('.brand-arrow-right');
            let current = 0;
            let intervalId = null;

            // Create dots
            slides.forEach((_, idx) => {
                const dot = document.createElement('div');
                dot.className = 'brand-dot' + (idx === 0 ? ' active' : '');
                dot.addEventListener('click', () => {
                    goToSlide(idx);
                    resetInterval();
                });
                dotsContainer.appendChild(dot);
            });

            function updateDots(idx) {
                dotsContainer.querySelectorAll('.brand-dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === idx);
                });
            }

            function updateArrowStates() {
                leftArrow.style.opacity = current === 0 ? '0.5' : '1';
                rightArrow.style.opacity = current === slides.length - 1 ? '0.5' : '1';
                leftArrow.style.pointerEvents = current === 0 ? 'none' : 'auto';
                rightArrow.style.pointerEvents = current === slides.length - 1 ? 'none' : 'auto';
            }

            function goToSlide(idx) {
                current = idx;
                slidesContainer.style.transform = `translateX(-${idx * 100}%)`;
                updateDots(idx);
                updateArrowStates();
            }

            function nextSlide() {
                if (current < slides.length - 1) {
                    goToSlide(current + 1);
                } else {
                    goToSlide(0); // Loop back to first slide
                }
            }

            function prevSlide() {
                if (current > 0) {
                    goToSlide(current - 1);
                } else {
                    goToSlide(slides.length - 1); // Loop to last slide
                }
            }

            function resetInterval() {
                if (intervalId) clearInterval(intervalId);
                intervalId = setInterval(nextSlide, 5000);
            }

            // Event listeners for arrows
            if (leftArrow) leftArrow.addEventListener('click', () => {
                prevSlide();
                resetInterval();
            });
            
            if (rightArrow) rightArrow.addEventListener('click', () => {
                nextSlide();
                resetInterval();
            });

            // Initialize
            goToSlide(0);
            resetInterval();

            // Pause on hover
            carousel.addEventListener('mouseenter', () => clearInterval(intervalId));
            carousel.addEventListener('mouseleave', resetInterval);

            // Responsive: update on window resize
            window.addEventListener('resize', () => goToSlide(current));
        });

        // Number count-up animation for .stat-number elements
        document.addEventListener('DOMContentLoaded', function () {
            function animateCountUp(el, target, duration) {
                let start = 0;
                let startTimestamp = null;
                const isPercent = /%$/.test(target);
                const isPlus = /\+$/.test(target);
                const cleanTarget = parseFloat(target.replace(/[^\d.]/g, ''));
                
                function step(timestamp) {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const value = Math.floor(progress * (cleanTarget - start) + start);
                    el.textContent = value + (isPercent ? '%' : '') + (isPlus ? '+' : '');
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    } else {
                        el.textContent = target; // Ensure final value is exact
                    }
                }
                window.requestAnimationFrame(step);
            }

            // Improved viewport detection for mobile
            function isInViewport(element) {
                const rect = element.getBoundingClientRect();
                const windowHeight = window.innerHeight || document.documentElement.clientHeight;
                const windowWidth = window.innerWidth || document.documentElement.clientWidth;
                
                // More lenient conditions for mobile
                return (
                    rect.top >= -100 && // Allow elements slightly above viewport
                    rect.left >= -50 &&  // Allow elements slightly to the left
                    rect.bottom <= windowHeight + 100 && // Allow elements slightly below viewport
                    rect.right <= windowWidth + 50 &&    // Allow elements slightly to the right
                    rect.width > 0 && rect.height > 0     // Element must be visible
                );
            }

            // Track animated elements to prevent re-animation
            const animatedElements = new Set();
            
            function triggerAnimations() {
                const statNumbers = document.querySelectorAll('.stat-number');
                
                statNumbers.forEach(function (el) {
                    // Skip if already animated
                    if (animatedElements.has(el)) return;
                    
                    if (isInViewport(el)) {
                        animatedElements.add(el);
                        const target = el.getAttribute('data-target') || el.textContent;
                        animateCountUp(el, target, 1500);
                    }
                });
            }

            // Force animation on mobile devices after a delay
            function forceAnimationOnMobile() {
                const isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    setTimeout(() => {
                        const statNumbers = document.querySelectorAll('.stat-number');
                        statNumbers.forEach(function (el) {
                            if (!animatedElements.has(el)) {
                                animatedElements.add(el);
                                const target = el.getAttribute('data-target') || el.textContent;
                                animateCountUp(el, target, 1500);
                            }
                        });
                    }, 2000); // Wait 2 seconds then force animation
                }
            }

            // Set data-target attribute for each stat-number
            document.querySelectorAll('.stat-number').forEach(function (el) {
                if (!el.getAttribute('data-target')) {
                    el.setAttribute('data-target', el.textContent.trim());
                }
                el.textContent = '0' + (/%$/.test(el.getAttribute('data-target')) ? '%' : '') + (/\+$/.test(el.getAttribute('data-target')) ? '+' : '');
            });

            // Use Intersection Observer for better performance and reliability
            const observerOptions = {
                root: null,
                rootMargin: '50px', // Trigger animation 50px before element enters viewport
                threshold: 0.1 // Trigger when 10% of element is visible
            };

            const statObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const el = entry.target.querySelector('.stat-number');
                        if (el && !animatedElements.has(el)) {
                            animatedElements.add(el);
                            const target = el.getAttribute('data-target') || el.textContent;
                            animateCountUp(el, target, 1500);
                        }
                    }
                });
            }, observerOptions);

            // Observe all stat items
            document.querySelectorAll('.stat-item').forEach(item => {
                statObserver.observe(item);
            });

            // Fallback methods
            window.addEventListener('scroll', triggerAnimations);
            window.addEventListener('resize', triggerAnimations);
            window.addEventListener('orientationchange', () => {
                setTimeout(triggerAnimations, 500); // Wait for orientation change to complete
            });
            
            // Initial trigger
            triggerAnimations();
            
            // Force animation on mobile as backup
            forceAnimationOnMobile();
            
            // Additional fallback - force animation when expertise section becomes visible
            const expertiseSection = document.querySelector('.expertise-section');
            if (expertiseSection) {
                const sectionObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            setTimeout(() => {
                                const statNumbers = document.querySelectorAll('.stat-number');
                                statNumbers.forEach(function (el) {
                                    if (!animatedElements.has(el)) {
                                        animatedElements.add(el);
                                        const target = el.getAttribute('data-target') || el.textContent;
                                        animateCountUp(el, target, 1500);
                                    }
                                });
                            }, 500);
                        }
                    });
                }, { threshold: 0.2 });
                
                sectionObserver.observe(expertiseSection);
            }
        });
        
        // Mobile Menu Toggle
        const mobileToggle = document.getElementById('mobile-toggle');
        const navMenu = document.getElementById('nav-menu');

        mobileToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
            const icon = mobileToggle.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        // Header Scroll Effect
        const header = document.getElementById('header');
        let lastScrollTop = 0;

        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
            
            lastScrollTop = scrollTop;
        });

        // Smooth Scrolling for Navigation Links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    const headerHeight = header.offsetHeight;
                    const targetPosition = target.offsetTop - headerHeight;
                    
                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
                
                // Close mobile menu if open
                navMenu.classList.remove('active');
                const icon = mobileToggle.querySelector('i');
                icon.classList.add('fa-bars');
                icon.classList.remove('fa-times');
            });
        });

        // Animate stats on scroll
        const observerOptions = {
            threshold: 0.5,
            rootMargin: '0px 0px -100px 0px'
        };

        const statObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animationPlayState = 'running';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.stat-item').forEach(item => {
            statObserver.observe(item);
        });

        // Add loading animation to cards
        const cardObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.usp-card, .testimonial-card, .reason-item').forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            cardObserver.observe(card);
        });

        // Add floating animation to hero elements
        document.addEventListener('DOMContentLoaded', () => {
            const heroContent = document.querySelector('.hero-content');
            const heroForm = document.querySelector('.hero-form');
            
            setTimeout(() => {
                heroContent.style.opacity = '1';
                heroContent.style.transform = 'translateY(0)';
            }, 300);
            
            setTimeout(() => {
                heroForm.style.opacity = '1';
                heroForm.style.transform = 'translateY(0)';
            }, 600);
        });

        // Add hover effect to brand logos
        document.querySelectorAll('.brand-logo').forEach(logo => {
            logo.addEventListener('mouseenter', () => {
                logo.style.backgroundColor = 'var(--bright-cyan)';
                logo.style.color = 'var(--white)';
            });
            
            logo.addEventListener('mouseleave', () => {
                logo.style.backgroundColor = 'var(--white)';
                logo.style.color = 'var(--primary-navy)';
            });
        });

        // Add click tracking for analytics (placeholder)
        document.querySelectorAll('.cta-button, .social-link, .nav-link').forEach(element => {
            element.addEventListener('click', (e) => {
                // Track clicks for analytics
                const elementType = e.target.className;
                const elementText = e.target.textContent || e.target.title;
                console.log(`Clicked: ${elementType} - ${elementText}`);
                
                // In a real application, send this to your analytics service
                // gtag('event', 'click', { element_type: elementType, element_text: elementText });
            });
        });

        // Preload critical images and optimize performance
        const criticalImages = [
            // Add any critical image URLs here
        ];

        criticalImages.forEach(src => {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = src;
            document.head.appendChild(link);
        });

        // Add typing effect to hero title (optional enhancement)
        const heroTitle = document.querySelector('.hero-title');
        const titleText = heroTitle.textContent;
        heroTitle.textContent = '';

        let i = 0;
        const typeWriter = () => {
            if (i < titleText.length) {
                heroTitle.textContent += titleText.charAt(i);
                i++;
                setTimeout(typeWriter, 50);
            }
        };

        setTimeout(typeWriter, 1000);

        // Add scroll progress indicator
        const scrollProgress = document.createElement('div');
        scrollProgress.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: var(--bright-cyan);
            z-index: 9999;
            transition: width 0.1s ease;
        `;
        document.body.appendChild(scrollProgress);

        window.addEventListener('scroll', () => {
            const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            scrollProgress.style.width = scrolled + '%';
        });




    </script>

     <!-- Footer -->
    </button>
    <footer class="footer" id="contact">
        <div class="footer-content">
            <div class="footer-section">
                <h3><i class="fas fa-building"></i> {{ page.company_name }}</h3>
                <div class="contact-info" itemscope itemtype="https://schema.org/LocalBusiness">
                    <p itemprop="name" style="font-weight: 600;">Air Conditioning Services Klang Valley</p>
                    <p><i class="fas fa-phone"></i> <a href="tel:{{ page.phone_primary }}" itemprop="telephone" style="text-decoration: underline; color: white;">{{ page.phone_primary }}</a></p>
                    {% if page.phone_secondary %}
                    <p><i class="fas fa-phone"></i> <a href="tel:{{ page.phone_secondary }}" itemprop="telephone" style="text-decoration: underline; color: white;">{{ page.phone_secondary }}</a></p>
                    {% endif %}
                    <div itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
                        <p><i class="fas fa-map-marker-alt"></i> 
                            <span itemprop="streetAddress">{{ page.address_street }}</span>, 
                            <span itemprop="postalCode">{{ page.address_postcode }}</span> 
                            <span itemprop="addressLocality">{{ page.address_city }}</span>, 
                            <span itemprop="addressRegion">{{ page.address_state }}</span>
                        </p>
                    </div>
                </div>
                <div class="social-links">
                    {% if page.facebook_url %}
                    <a href="{{ page.facebook_url }}" class="social-link" target="_blank">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    {% endif %}
                    <a href="https://wa.me/{{page.whatsapp_number}}?text={{ page.whatsapp_message|urlencode }}" class="social-link" target="_blank">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>

            <div class="footer-map" style="width: 100%; margin-right: 300px;">
                {{ page.google_maps_embed|safe }}
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 {{ page.company_name }}. All Rights Reserved.</p>
        </div>
    </footer>
    <a href="https://wa.me/{{ page.whatsapp_number }}?text={{ page.whatsapp_message|urlencode }}" class="whatsapp-float" target="_blank" rel="noopener noreferrer" aria-label="Chat on WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>
    </body>
</html>